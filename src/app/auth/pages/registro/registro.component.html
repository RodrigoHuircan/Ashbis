<ion-content [fullscreen]="true" class="ion-padding">
  <ion-grid fixed class="ion-justify-content-center ion-align-items-center" style="min-height: 100%;">
    <ion-row class="ion-justify-content-center">
      <ion-col size="12" sizeSm="10" sizeMd="8" sizeLg="6">
        <ion-card>
          <ion-card-header class="ion-text-center">
            <ion-thumbnail style="--size: 125px; margin: 12px auto; --border-radius: 16px;">
              <ion-img src="assets/img/logo_ashbis.jpeg" alt="ASHBIS" loading="lazy"></ion-img>
            </ion-thumbnail>
            <ion-card-title>¡Registrate!</ion-card-title>
          </ion-card-header>
          <ion-card-content class="si">
            <form [formGroup]="datosForm" (ngSubmit)="registrarse()" novalidate>
              <ion-list class="list" lines="inset">
                <ion-item>
                  <ion-label position="stacked">
                    Nombre <span class="required">*</span>
                  </ion-label>
                  <ion-input
                    formControlName="nombre"
                    (ionBlur)="datosForm.get('nombre')?.markAsTouched()">
                  </ion-input>
                </ion-item>
                <ion-note color="danger" *ngIf="f.nombre.touched && f.nombre.hasError('required')">El nombre es obligatorio</ion-note>
                <ion-note color="danger" *ngIf="f.nombre.touched && f.nombre.hasError('minlength')">El nombre debe tener al menos 3 caracteres</ion-note>
                <ion-note color="danger" *ngIf="f.nombre.touched && f.nombre.hasError('pattern')">Sólo letras y espacios permitidos</ion-note>
                <ion-note color="danger" *ngIf="f.nombre.touched && f.nombre.hasError('onlySpaces')">No puede ser solo espacios</ion-note>
                <ion-item>
                  <ion-label position="stacked">
                    Apellido <span class="required">*</span>
                  </ion-label>
                  <ion-input
                    formControlName="apellido"
                    (ionBlur)="datosForm.get('apellido')?.markAsTouched()">
                  </ion-input>
                </ion-item>
                <ion-note color="danger" *ngIf="f.apellido.touched && f.apellido.hasError('required')">El apellido es obligatorio</ion-note>
                <ion-note color="danger" *ngIf="f.apellido.touched && f.apellido.hasError('minlength')">El apellido debe tener al menos 3 caracteres</ion-note>
                <ion-note color="danger" *ngIf="f.apellido.touched && f.apellido.hasError('pattern')">Sólo letras y espacios permitidos</ion-note>
                <ion-note color="danger" *ngIf="f.apellido.touched && f.apellido.hasError('onlySpaces')">No puede ser solo espacios</ion-note>
                <ion-item>
                  <ion-label position="stacked">
                    Teléfono <span class="required">*</span>
                  </ion-label>
                  <ion-input
                    type="tel"
                    inputmode="tel"
                    placeholder="+569XXXXXXXX"
                    formControlName="telefono"
                    (ionBlur)="datosForm.get('telefono')?.markAsTouched()">
                  </ion-input>
                </ion-item>
                <ion-note color="danger" *ngIf="f.telefono.touched && f.telefono.hasError('required')">El teléfono es obligatorio</ion-note>
                <ion-note color="danger" *ngIf="f.telefono.touched && f.telefono.hasError('pattern')">Formato inválido. Ej: +569XXXXXXXX o 9XXXXXXXX</ion-note>
                <ion-item>
                  <ion-label position="stacked">
                    Dirección <span class="required">*</span>
                  </ion-label>
                  <ion-input
                    formControlName="direccion"
                    (ionBlur)="datosForm.get('direccion')?.markAsTouched()">
                  </ion-input>
                </ion-item>
                <ion-note color="danger" *ngIf="f.direccion.touched && f.direccion.hasError('required')">La dirección es obligatoria</ion-note>
                <ion-note color="danger" *ngIf="f.direccion.touched && f.direccion.hasError('minlength')">La dirección debe tener al menos 10 caracteres</ion-note>
                <ion-note color="danger" *ngIf="f.direccion.touched && f.direccion.hasError('onlySpaces')">No puede ser solo espacios</ion-note>
                <ion-item>
                  <ion-label position="stacked">Región <span class="required">*</span></ion-label>
                  <ion-select
                    interface="popover"
                    placeholder="Selecciona una región"
                    formControlName="region"
                    (ionBlur)="datosForm.get('region')?.markAsTouched()">
                      <ion-select-option value="I">Tarapacá</ion-select-option>
                      <ion-select-option value="II">Antofagasta</ion-select-option>
                      <ion-select-option value="III">Atacama</ion-select-option>
                      <ion-select-option value="IV">Coquimbo</ion-select-option>
                      <ion-select-option value="V">Valparaíso</ion-select-option>
                      <ion-select-option value="RM">Región Metropolitana</ion-select-option>
                      <ion-select-option value="VI">O’Higgins</ion-select-option>
                      <ion-select-option value="VII">Maule</ion-select-option>
                      <ion-select-option value="XVI">Ñuble</ion-select-option>
                      <ion-select-option value="VIII">Biobío</ion-select-option>
                      <ion-select-option value="IX">La Araucanía</ion-select-option>
                      <ion-select-option value="X">Los Lagos</ion-select-option>
                      <ion-select-option value="XI">Aysén</ion-select-option>
                      <ion-select-option value="XII">Magallanes y Antártica Chilena</ion-select-option>
                      <ion-select-option value="XV">Arica y Parinacota</ion-select-option>
                  </ion-select>
                </ion-item>
                <ion-note color="danger" 
                *ngIf="f.region.touched && f.region.hasError('required')">
                La región es obligatoria</ion-note>
                <ion-item>
                  <ion-label position="stacked">Email <span class="required">*</span></ion-label>
                  <ion-input
                    type="email"
                    inputmode="email"
                    autocomplete="email"
                    placeholder="usuario@gmail.com"
                    formControlName="email"
                    (ionBlur)="datosForm.get('email')?.markAsTouched()">
                  </ion-input>
                </ion-item>
                <ion-note color="danger" 
                *ngIf="f.email.touched && f.email.hasError('required')">
                El email es obligatorio</ion-note>
                <ion-note color="danger" 
                *ngIf="f.email.touched && f.email.hasError('gmail')">
                Solo direcciones @gmail.com son permitidas</ion-note>
                <ion-note color="danger" 
                *ngIf="f.email.touched && f.email.hasError('email') && !f.email.hasError('gmail')">
                Formato de email inválido</ion-note>
                <ion-item>
                  <ion-label position="stacked">Contraseña <span class="required">*</span></ion-label>
                  <ion-input
                    [type]="mostrarPass ? 'text' : 'password'"
                    autocomplete="new-password"
                    formControlName="password"
                    (ionInput)="onPasswordInput()"
                    (ionBlur)="datosForm.get('password')?.markAsTouched()">
                  </ion-input>
                  <ion-button  type="button" slot="end" fill="clear"
                    (click)="mostrarPass = !mostrarPass"
                    [aria-label]="mostrarPass ? 'Ocultar contraseña' : 'Mostrar contraseña'">
                    <ion-icon [name]="mostrarPass ? 'eye-off' : 'eye'" ></ion-icon>
                  </ion-button>
                </ion-item>
                <ion-note color="danger" 
                *ngIf="f.password.touched && f.password.hasError('required')">
                La contraseña es obligatoria</ion-note>
                <ion-note color="danger" 
                *ngIf="f.password.touched && f.password.hasError('minlength')">
                La contraseña debe tener al menos 8 caracteres</ion-note>
                <ion-note color="danger" 
                *ngIf="f.password.touched && f.password.hasError('pattern')">
                La contraseña debe incluir letras y números</ion-note>
                <div class="pw-meter" *ngIf="pwStrength">
                  <div class="pw-meter-fill" [style.width.%]="pwStrength.percent"></div>
                </div>
                <div class="pw-strength-text" *ngIf="pwStrength">{{ pwStrength.label }}</div>
                <ion-note class="contrasena" *ngIf="!pwStrength">Usa al menos 8 caracteres, mezcla letras, números y símbolos.</ion-note>
                <ion-item>
                  <ion-label position="stacked">Confirmar contraseña <span class="required">*</span></ion-label>
                  <ion-input
                    [type]="mostrarPass2 ? 'text' : 'password'"
                    autocomplete="new-password"
                    formControlName="confirmPassword"
                    (ionBlur)="datosForm.get('confirmPassword')?.markAsTouched()">
                  </ion-input>
                  <ion-button  type="button" slot="end" fill="clear"
                    (click)="mostrarPass2 = !mostrarPass2"
                    [aria-label]="mostrarPass2 ? 'Ocultar confirmar contraseña' : 'Mostrar confirmar contraseña'">
                    <ion-icon  [name]="mostrarPass2 ? 'eye-off' : 'eye'" ></ion-icon>
                  </ion-button>
                </ion-item>
                <ion-note color="danger" *ngIf="f.confirmPassword.touched && f.confirmPassword.hasError('required')">Debes confirmar la contraseña</ion-note>
                <ion-note color="danger" *ngIf="datosForm.touched && datosForm.hasError('passwordMismatch')">Las contraseñas no coinciden</ion-note>
              </ion-list>
              <ion-button
                type="submit"
                expand="block"
                class="ion-margin-top"
                [disabled]="cargando || datosForm.invalid || datosForm.hasError('passwordMismatch')"
                color="danger">
                <ng-container *ngIf="!cargando; else loadingTpl">Crear cuenta</ng-container>
              </ion-button>
              <ng-template #loadingTpl>
                <ion-spinner name="crescent"></ion-spinner>
              </ng-template>
              <ion-button type="button" color="medium" expand="block" (click)="irALogin()">
                Volver a Ingresar
              </ion-button>
            </form>
          </ion-card-content>
        </ion-card>
        <div class="ion-text-center ion-margin-top">
          <ion-button fill="clear" size="small" href="https://www.ashbis.com" target="_blank" rel="noopener" color="medium">
            www.ashbis.com
          </ion-button>
        </div>
      </ion-col>
    </ion-row>
  </ion-grid>
</ion-content>
