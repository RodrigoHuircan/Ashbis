<ion-content [fullscreen]="true" style="--background:#000;">
  <ion-grid fixed>
    <ion-row class="ion-justify-content-center">
      <ion-col size="12" size-md="8" size-lg="5" class="ion-text-center">

        <h1 style="color:#fff; margin:18px 0 12px; font-weight:800;">Agregar Mascota</h1>

        <!-- Imagen de la mascota -->
        <div style="margin-bottom:20px;">
          <ion-img
            [src]="imagenPreview || 'assets/img/placeholder_pet.png'"
            alt="Foto Mascota"
            style="width:140px; height:140px; border-radius:20px; object-fit:cover; margin:0 auto 12px; background:#222; box-shadow:0 0 10px rgba(255,255,255,0.1);"
          ></ion-img>

          <input type="file" accept="image/*" (change)="onImageSelected($event)" style="display:none" #fileInput />

          <ion-button size="small" color="light" fill="outline" (click)="fileInput.click()" style="--border-radius:18px; --border-color:#fff;">
            Seleccionar Foto
          </ion-button>
        </div>

        <!-- Formulario -->
        <form [formGroup]="mascotaForm" (ngSubmit)="guardarMascota()">
          <ion-list lines="none" style="background:transparent; color:#fff;">

            <!-- Campos normales -->
            <ion-item class="field-underline-red">
              <ion-label position="stacked" color="medium">Nombre</ion-label>
              <ion-input formControlName="nombre" placeholder="Nombre de la mascota"></ion-input>
            </ion-item>

            <ion-item class="field-underline-red ion-margin-top">
              <ion-label position="stacked" color="medium">Número de chip</ion-label>
              <ion-input type="number" formControlName="numeroChip" placeholder="Ej: 1234567890"></ion-input>
            </ion-item>

            <ion-item class="field-underline-red ion-margin-top">
              <ion-label position="stacked" color="medium">Edad</ion-label>
              <ion-input type="number" formControlName="edad" placeholder="Ej: 2"></ion-input>
            </ion-item>

            <ion-item class="field-underline-red ion-margin-top">
              <ion-label position="stacked" color="medium">Sexo</ion-label>
              <ion-select formControlName="sexo" placeholder="Selecciona sexo">
                <ion-select-option value="Macho">Macho</ion-select-option>
                <ion-select-option value="Hembra">Hembra</ion-select-option>
              </ion-select>
            </ion-item>

            <!-- Fecha de nacimiento (FUNCIONAL) -->
            <!-- Fecha de nacimiento -->
            <ion-item class="field-underline-red ion-margin-top">
              <ion-label position="stacked" color="medium">Fecha de nacimiento</ion-label>

              <div class="fecha-display" (click)="abrirInputFecha()">
                <ion-icon name="calendar-outline"></ion-icon>
                <span>{{ fechaFormateada || 'Seleccionar fecha' }}</span>
              </div>

              <!-- input oculto, pero accesible -->
              <input
                #inputFecha
                type="date"
                (change)="onNativeDateChange($event)"
                [max]="fechaActual | date:'yyyy-MM-dd'"
                class="input-fecha-oculto"
              />
            </ion-item>




            <!-- Resto del formulario -->
            <ion-item class="field-underline-red ion-margin-top">
              <ion-label position="stacked" color="medium">Especie</ion-label>
              <ion-select formControlName="especie" placeholder="Ej: Perro, Gato...">
                <ion-select-option value="Perro">Perro</ion-select-option>
                <ion-select-option value="Gato">Gato</ion-select-option>
                <ion-select-option value="Otro">Otro</ion-select-option>
              </ion-select>
            </ion-item>

            <ion-item class="field-underline-red ion-margin-top">
              <ion-label position="stacked" color="medium">Color</ion-label>
              <ion-input formControlName="color" placeholder="Ej: Marrón, Negro..."></ion-input>
            </ion-item>

            <ion-item class="field-underline-red ion-margin-top">
              <ion-label position="stacked" color="medium">Raza</ion-label>
              <ion-input formControlName="raza" placeholder="Ej: Labrador, Persa..."></ion-input>
            </ion-item>

            <ion-item class="field-underline-red ion-margin-top">
              <ion-label position="stacked" color="medium">Castrado / Esterilizado</ion-label>
              <ion-select formControlName="castrado" placeholder="Selecciona una opción">
                <ion-select-option value="Sí">Sí</ion-select-option>
                <ion-select-option value="No">No</ion-select-option>
              </ion-select>
            </ion-item>
          </ion-list>

          <ion-button
            type="submit"
            expand="block"
            style="--background:#fff; --color:#d60000; --border-radius:20px; margin-top:24px; font-weight:700;"
            [disabled]="cargando || mascotaForm.invalid"
          >
            {{ cargando ? 'Guardando...' : 'Guardar Mascota' }}
          </ion-button>
        </form>
      </ion-col>
    </ion-row>
  </ion-grid>
</ion-content>
